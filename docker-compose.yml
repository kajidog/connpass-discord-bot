services:
  bot:
    build: .
    environment:
      DISCORD_BOT_TOKEN: ${DISCORD_BOT_TOKEN}
      DISCORD_APPLICATION_ID: ${DISCORD_APPLICATION_ID}
      CONNPASS_API_KEY: ${CONNPASS_API_KEY}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      GOOGLE_GENERATIVE_AI_API_KEY: ${GOOGLE_GENERATIVE_AI_API_KEY:-}
      ENABLE_AI_AGENT: ${ENABLE_AI_AGENT:-true}
      JOB_STORE_DIR: /data
      STORAGE_TYPE: ${STORAGE_TYPE:-sqlite}
      DATABASE_URL: /data/app.db
      AGENT_DATABASE_URL: file:/data/agent-memory.db
      AI_CONFIG_PATH: ${AI_CONFIG_PATH:-}
      ENABLE_EVENT_NOTIFY: ${ENABLE_EVENT_NOTIFY:-true}
      DEFAULT_NOTIFY_MINUTES_BEFORE: ${DEFAULT_NOTIFY_MINUTES_BEFORE:-15}
      NOTIFY_CHECK_INTERVAL_MS: ${NOTIFY_CHECK_INTERVAL_MS:-60000}
    volumes:
      - bot-data:/data
      - ./apps:/app/apps
      - ./packages:/app/packages
      - /app/apps/discord-bot/node_modules
      - /app/apps/cli/node_modules
      - /app/apps/ai-agent/node_modules
      - /app/packages/feed-worker/node_modules
      - /app/packages/core/node_modules
    restart: unless-stopped

volumes:
  bot-data:

    # CLI使用例（インタラクティブモード）:
    # docker compose run --rm -it bot pnpm --filter @connpass-discord-bot/cli start
